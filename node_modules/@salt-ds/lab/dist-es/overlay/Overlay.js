import { jsx } from 'react/jsx-runtime';
import { forwardRef, useRef, useMemo } from 'react';
import { OverlayContext } from './OverlayContext.js';
import { useId, useControlled, useFloatingUI } from '@salt-ds/core';
import { offset, flip, shift, limitShift, arrow, useInteractions, useRole, useClick, useDismiss } from '@floating-ui/react';

const Overlay = forwardRef(
  function Overlay2(props, ref) {
    const {
      children,
      open,
      onOpenChange,
      placement: placementProp = "top",
      id: idProp,
      onClose,
      ...rest
    } = props;
    const id = useId(idProp);
    const arrowRef = useRef(null);
    const [openState, setOpenState] = useControlled({
      controlled: open,
      default: false,
      name: "Overlay",
      state: "open"
    });
    const {
      x,
      y,
      strategy,
      context,
      elements,
      floating,
      reference,
      placement
    } = useFloatingUI({
      open: openState,
      onOpenChange: setOpenState,
      placement: placementProp,
      middleware: [
        offset(11),
        flip(),
        shift({ limiter: limitShift() }),
        arrow({ element: arrowRef })
      ]
    });
    const { getReferenceProps, getFloatingProps } = useInteractions([
      useRole(context, { role: "dialog" }),
      useClick(context),
      useDismiss(context)
    ]);
    const floatingStyles = useMemo(() => {
      var _a, _b;
      return {
        top: y != null ? y : 0,
        left: x != null ? x : 0,
        position: strategy,
        width: (_a = elements.floating) == null ? void 0 : _a.offsetWidth,
        height: (_b = elements.floating) == null ? void 0 : _b.offsetHeight
      };
    }, [elements.floating, strategy, x, y]);
    const setOpen = (event, newOpen) => {
      setOpenState(newOpen);
      onOpenChange == null ? void 0 : onOpenChange(event, newOpen);
    };
    const arrowProps = {
      ref: arrowRef,
      context
    };
    const handleCloseButton = (event) => {
      setOpen(event, false);
      onClose == null ? void 0 : onClose(event);
    };
    return /* @__PURE__ */ jsx(OverlayContext.Provider, {
      value: {
        id: id != null ? id : "",
        openState,
        setOpen,
        floatingStyles,
        placement,
        context,
        arrowProps,
        floating,
        reference,
        handleCloseButton,
        getFloatingProps,
        getReferenceProps
      },
      children: /* @__PURE__ */ jsx("div", {
        ref,
        ...rest,
        children
      })
    });
  }
);

export { Overlay };
//# sourceMappingURL=Overlay.js.map
