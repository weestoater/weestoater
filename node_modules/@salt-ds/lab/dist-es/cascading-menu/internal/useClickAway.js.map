{"version":3,"file":"useClickAway.js","sources":["../src/cascading-menu/internal/useClickAway.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport { useEventCallback } from \"../../utils\";\n\nimport { useMountedRef } from \"./useMountedRef\";\n\nfunction eventComingFromNodes(nodes: HTMLElement[], event: MouseEvent) {\n  return nodes.some(\n    (node) =>\n      node != null &&\n      (node === event.target || node.contains(event.target as HTMLElement))\n  );\n}\n\ntype clickAwayHook = (\n  nodes: HTMLElement[] | (() => HTMLElement[]) | null,\n  containingDocument: Document,\n  onClickAway: (event: FocusEvent) => void,\n  onClick: (event: MouseEvent) => void,\n  mouseEvent?: keyof DocumentEventMap\n) => void;\n\nexport const useClickAway: clickAwayHook = (\n  nodes,\n  containingDocument,\n  onClickAway,\n  onClick = () => undefined,\n  mouseEvent = \"mouseup\"\n) => {\n  //TODO can we get rid of this if it's just for IE11 ?\n  const mountedRef = useMountedRef();\n\n  const handleClickAway = useEventCallback((event: MouseEvent) => {\n    // Ignore events that have been `event.preventDefault()` marked.\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    // IE 11 support, which trigger the handleClickAway even after the unbind\n    if (!mountedRef.current) {\n      return;\n    }\n\n    onClick(event);\n\n    if (!nodes) {\n      return;\n    }\n\n    const resolvedNodes = typeof nodes === \"function\" ? nodes() : nodes;\n    const isEventComingFromNodes = eventComingFromNodes(resolvedNodes, event);\n\n    const ownerDocumentNode = resolvedNodes.find((node) =>\n      // node could be null, e.g. left click on surrounding area of context menu examples\n      node ? node.ownerDocument : false\n    );\n    const doc =\n      containingDocument ||\n      (ownerDocumentNode && ownerDocumentNode.ownerDocument);\n\n    if (\n      doc.documentElement &&\n      doc.documentElement.contains(event.target as HTMLElement) &&\n      !isEventComingFromNodes\n    ) {\n      onClickAway(event);\n    }\n  });\n\n  useEffect(() => {\n    if (containingDocument) {\n      containingDocument.addEventListener(\n        mouseEvent,\n        handleClickAway as EventListener\n      );\n      containingDocument.defaultView?.addEventListener(\"blur\", onClickAway);\n    }\n    return () => {\n      if (containingDocument) {\n        containingDocument.removeEventListener(\n          mouseEvent,\n          handleClickAway as EventListener\n        );\n        containingDocument.defaultView?.removeEventListener(\n          \"blur\",\n          onClickAway\n        );\n      }\n    };\n  }, [handleClickAway, mouseEvent, containingDocument, onClickAway]);\n};\n"],"names":["_a"],"mappings":";;;;;AAKA,SAAS,oBAAA,CAAqB,OAAsB,KAAmB,EAAA;AACrE,EAAA,OAAO,KAAM,CAAA,IAAA;AAAA,IACX,CAAC,IACC,KAAA,IAAA,IAAQ,IACP,KAAA,IAAA,KAAS,MAAM,MAAU,IAAA,IAAA,CAAK,QAAS,CAAA,KAAA,CAAM,MAAqB,CAAA,CAAA;AAAA,GACvE,CAAA;AACF,CAAA;AAUa,MAAA,YAAA,GAA8B,CACzC,KACA,EAAA,kBAAA,EACA,aACA,OAAU,GAAA,MAAM,KAChB,CAAA,EAAA,UAAA,GAAa,SACV,KAAA;AAEH,EAAA,MAAM,aAAa,aAAc,EAAA,CAAA;AAEjC,EAAM,MAAA,eAAA,GAAkB,gBAAiB,CAAA,CAAC,KAAsB,KAAA;AAE9D,IAAA,IAAI,MAAM,gBAAkB,EAAA;AAC1B,MAAA,OAAA;AAAA,KACF;AAGA,IAAI,IAAA,CAAC,WAAW,OAAS,EAAA;AACvB,MAAA,OAAA;AAAA,KACF;AAEA,IAAA,OAAA,CAAQ,KAAK,CAAA,CAAA;AAEb,IAAA,IAAI,CAAC,KAAO,EAAA;AACV,MAAA,OAAA;AAAA,KACF;AAEA,IAAA,MAAM,aAAgB,GAAA,OAAO,KAAU,KAAA,UAAA,GAAa,OAAU,GAAA,KAAA,CAAA;AAC9D,IAAM,MAAA,sBAAA,GAAyB,oBAAqB,CAAA,aAAA,EAAe,KAAK,CAAA,CAAA;AAExE,IAAA,MAAM,oBAAoB,aAAc,CAAA,IAAA;AAAA,MAAK,CAAC,IAAA,KAE5C,IAAO,GAAA,IAAA,CAAK,aAAgB,GAAA,KAAA;AAAA,KAC9B,CAAA;AACA,IAAM,MAAA,GAAA,GACJ,kBACC,IAAA,iBAAA,IAAqB,iBAAkB,CAAA,aAAA,CAAA;AAE1C,IACE,IAAA,GAAA,CAAI,mBACJ,GAAI,CAAA,eAAA,CAAgB,SAAS,KAAM,CAAA,MAAqB,CACxD,IAAA,CAAC,sBACD,EAAA;AACA,MAAA,WAAA,CAAY,KAAK,CAAA,CAAA;AAAA,KACnB;AAAA,GACD,CAAA,CAAA;AAED,EAAA,SAAA,CAAU,MAAM;AApElB,IAAA,IAAA,EAAA,CAAA;AAqEI,IAAA,IAAI,kBAAoB,EAAA;AACtB,MAAmB,kBAAA,CAAA,gBAAA;AAAA,QACjB,UAAA;AAAA,QACA,eAAA;AAAA,OACF,CAAA;AACA,MAAmB,CAAA,EAAA,GAAA,kBAAA,CAAA,WAAA,KAAnB,IAAgC,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,gBAAA,CAAiB,MAAQ,EAAA,WAAA,CAAA,CAAA;AAAA,KAC3D;AACA,IAAA,OAAO,MAAM;AA5EjB,MAAAA,IAAAA,GAAAA,CAAAA;AA6EM,MAAA,IAAI,kBAAoB,EAAA;AACtB,QAAmB,kBAAA,CAAA,mBAAA;AAAA,UACjB,UAAA;AAAA,UACA,eAAA;AAAA,SACF,CAAA;AACA,QAAA,CAAAA,GAAA,GAAA,kBAAA,CAAmB,WAAnB,KAAA,IAAA,GAAA,KAAA,CAAA,GAAAA,GAAgC,CAAA,mBAAA;AAAA,UAC9B,MAAA;AAAA,UACA,WAAA;AAAA,SAAA,CAAA;AAAA,OAEJ;AAAA,KACF,CAAA;AAAA,KACC,CAAC,eAAA,EAAiB,UAAY,EAAA,kBAAA,EAAoB,WAAW,CAAC,CAAA,CAAA;AACnE;;;;"}