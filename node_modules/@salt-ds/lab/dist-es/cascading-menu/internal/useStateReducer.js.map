{"version":3,"file":"useStateReducer.js","sources":["../src/cascading-menu/internal/useStateReducer.ts"],"sourcesContent":["import { useCallback } from \"react\";\n\nimport { flattenedMenuState, menuState } from \"./stateUtils\";\nimport { CascadingMenuAction, menuAction } from \"./CascadingMenuAction\";\n\nexport type stateItem = {\n  id: string;\n  highlightedItemIndex: number | null;\n};\n\ntype state = stateItem[];\n\nfunction getDefaultMenuState(id: string): stateItem {\n  return {\n    id,\n    highlightedItemIndex: null,\n  };\n}\n\nfunction deleteAllMenusStartingFromLevel(level: number, menus: stateItem[]) {\n  const newState = [...menus];\n  newState.splice(level);\n  return newState;\n}\n\nfunction menuPositionReducer(state: state, action: menuAction, level: number) {\n  const { type } = action;\n  switch (type) {\n    case CascadingMenuAction.SET_FLIPPED:\n      state[level] = {\n        ...state[level],\n      };\n      return state;\n    default:\n      return state;\n  }\n}\n\nexport function useStateReducer(\n  menusDataById: flattenedMenuState = {},\n  isNavigatingWithKeyboard: boolean\n) {\n  return useCallback(\n    (state: state, action: menuAction): state => {\n      let newState = [...state];\n      const { type, targetId, highlightedItemIndex = null } = action;\n      const { level, childMenus = [] } = Object(\n        menusDataById[targetId]\n      ) as menuState;\n      const childId =\n        typeof highlightedItemIndex === \"number\"\n          ? childMenus[highlightedItemIndex]\n          : null;\n      const childMenuData = childId ? menusDataById[childId] : undefined;\n\n      newState = menuPositionReducer(newState, action, level);\n      switch (type) {\n        case CascadingMenuAction.SET_CURRENT_INTERACTED_ITEM:\n          newState[level] = {\n            ...newState[level],\n            highlightedItemIndex,\n          };\n          newState = deleteAllMenusStartingFromLevel(level + 1, newState);\n          if (childId && childMenuData && !isNavigatingWithKeyboard) {\n            newState[childMenuData.level] = getDefaultMenuState(childId);\n          }\n          break;\n        case CascadingMenuAction.RESET_MENU:\n          newState[level] = {\n            ...newState[level],\n            highlightedItemIndex: null,\n          };\n          newState = deleteAllMenusStartingFromLevel(level + 1, newState);\n          break;\n        case CascadingMenuAction.OPEN_MENU:\n          newState[level] = getDefaultMenuState(targetId);\n          break;\n        case CascadingMenuAction.CLOSE_MENU:\n          newState = deleteAllMenusStartingFromLevel(level, newState);\n          break;\n        case CascadingMenuAction.CLOSE_CASCADING_MENU:\n          newState = [];\n          break;\n        default:\n          break;\n      }\n      return newState;\n    },\n    [isNavigatingWithKeyboard, menusDataById]\n  );\n}\n"],"names":[],"mappings":"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"}