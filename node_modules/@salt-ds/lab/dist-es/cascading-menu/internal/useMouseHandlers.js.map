{"version":3,"file":"useMouseHandlers.js","sources":["../src/cascading-menu/internal/useMouseHandlers.ts"],"sourcesContent":["import {\n  useCallback,\n  useRef,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  MouseEvent,\n} from \"react\";\n\nimport { CascadingMenuListProps } from \"../CascadingMenuList\";\nimport { CascadingMenuAction } from \"./CascadingMenuAction\";\nimport { stateChangeTypes } from \"../stateChangeTypes\";\n\nfunction isOrContainsNode(parent: HTMLElement | null, child: HTMLElement) {\n  return parent === child || !!parent?.contains?.(child);\n}\n\nexport function useMouseHandlers(\n  props: CascadingMenuListProps,\n  isMenuActiveState: [boolean, Dispatch<SetStateAction<boolean>>],\n  menuRef: HTMLElement | null\n) {\n  const [isMenuActive, setIsMenuActive] = isMenuActiveState;\n  const {\n    delay,\n    refsManager,\n    dispatch,\n    isNavigatingWithKeyboard,\n    setIsNavigatingWithKeyboard,\n    data,\n    highlightedItemIndex,\n    menuId,\n    parentElement,\n  } = props;\n  const scheduledHighlightedIndexChange = useRef<number | null>(null);\n  const mouseEnterTimer = useRef<number>();\n  const mouseOutTimer = useRef<number>();\n\n  useEffect(\n    () =>\n      function cleanUpTimeouts() {\n        clearTimeout(mouseEnterTimer.current);\n        clearTimeout(mouseOutTimer.current);\n      },\n    []\n  );\n\n  const handleMouseMove = useCallback(\n    (highlightedIndex: number) => {\n      if (isNavigatingWithKeyboard) {\n        setIsNavigatingWithKeyboard(false);\n      }\n\n      if (!isMenuActive) {\n        setIsMenuActive(true);\n      }\n      if (scheduledHighlightedIndexChange.current !== highlightedIndex) {\n        scheduledHighlightedIndexChange.current = highlightedIndex;\n        clearTimeout(mouseEnterTimer.current);\n        clearTimeout(mouseOutTimer.current);\n        mouseEnterTimer.current = window.setTimeout(() => {\n          dispatch({\n            type: CascadingMenuAction.SET_CURRENT_INTERACTED_ITEM,\n            cause: stateChangeTypes.ITEM_MOUSE_ENTER,\n            targetId: menuId,\n            highlightedItemIndex: highlightedIndex,\n          });\n        }, delay);\n      }\n    },\n    [\n      isNavigatingWithKeyboard,\n      isMenuActive,\n      setIsNavigatingWithKeyboard,\n      setIsMenuActive,\n      delay,\n      dispatch,\n      menuId,\n    ]\n  );\n  const handleMouseOut = useCallback(\n    (event: MouseEvent<HTMLElement>) => {\n      if (isNavigatingWithKeyboard) {\n        setIsNavigatingWithKeyboard(false);\n      }\n      clearTimeout(mouseOutTimer.current);\n      // If mouse leaves from parent menu into other element other than submenu -> close submenu\n      const { relatedTarget } = event;\n      const subMenuElement =\n        typeof highlightedItemIndex === \"number\"\n          ? refsManager.get(data.childMenus[highlightedItemIndex]) ?? null\n          : null;\n\n      const mouseMovedToSameMenu = isOrContainsNode(\n        menuRef,\n        relatedTarget as HTMLElement\n      );\n      const mouseMovedToParentMenu = isOrContainsNode(\n        parentElement ?? null,\n        relatedTarget as HTMLElement\n      );\n\n      if (mouseMovedToParentMenu) {\n        dispatch({\n          type: CascadingMenuAction.SET_CURRENT_INTERACTED_ITEM,\n          cause: stateChangeTypes.ITEM_MOUSE_MOVE_TO_PARENT,\n          targetId: menuId,\n          highlightedItemIndex: null,\n        });\n      }\n      const didMouseMoveOutOfMenu = !(\n        mouseMovedToParentMenu ||\n        mouseMovedToSameMenu ||\n        isOrContainsNode(subMenuElement, relatedTarget as HTMLElement)\n      );\n\n      if (didMouseMoveOutOfMenu) {\n        scheduledHighlightedIndexChange.current = null;\n        if (!isMenuActive) {\n          setIsMenuActive(true);\n          clearInterval(mouseEnterTimer.current);\n          mouseOutTimer.current = window.setTimeout(() => {\n            dispatch({\n              type: CascadingMenuAction.RESET_MENU,\n              cause: stateChangeTypes.MOUSE_OUT_OF_MENUS,\n              targetId: menuId,\n            });\n          }, delay);\n        }\n      } else if (!mouseMovedToSameMenu) {\n        setIsMenuActive(false);\n      }\n    },\n    [\n      isNavigatingWithKeyboard,\n      refsManager,\n      data.childMenus,\n      highlightedItemIndex,\n      menuRef,\n      parentElement,\n      setIsNavigatingWithKeyboard,\n      dispatch,\n      menuId,\n      isMenuActive,\n      delay,\n      setIsMenuActive,\n    ]\n  );\n  return [handleMouseMove, handleMouseOut] as const;\n}\n"],"names":[],"mappings":"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"}