{"version":3,"file":"MultiSelectComboBox.js","sources":["../src/combo-box-deprecated/internal/MultiSelectComboBox.tsx"],"sourcesContent":["import { flip, limitShift, shift, size } from \"@floating-ui/react\";\nimport { useAriaAnnouncer, useFloatingUI, useForkRef } from \"@salt-ds/core\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { Portal } from \"../../portal\";\nimport { ListBase, ListStateContext } from \"../../list-deprecated\";\nimport { TokenizedInputBase, TokenizedInputProps } from \"../../tokenized-input\";\nimport { BaseComboBoxProps } from \"./DefaultComboBox\";\nimport { getAnnouncement } from \"./getAnnouncement\";\nimport { useMultiSelectComboBox } from \"./useMultiSelectComboBox\";\nimport { isDesktop, useWindow } from \"../../window\";\n\nexport type MultiSelectComboBoxProps<Item> = BaseComboBoxProps<\n  Item,\n  \"multiple\"\n> &\n  Pick<\n    TokenizedInputProps<Item>,\n    | \"onFocus\"\n    | \"onBlur\"\n    | \"onInputFocus\"\n    | \"onInputBlur\"\n    | \"onInputChange\"\n    | \"onInputSelect\"\n    | \"stringToItem\"\n  > & {\n    InputProps?: Partial<TokenizedInputProps<Item>>;\n    initialSelectedItem?: Item[];\n    selectedItem?: Item[];\n    multiSelect: true;\n    delimiter?: string | string[];\n  };\n\nexport function MultiSelectComboBox<Item>(\n  props: MultiSelectComboBoxProps<Item>\n) {\n  const {\n    ListItem,\n    WindowProps,\n    rootRef,\n    listRef: listRefProp,\n    rootWidth,\n    listWidth,\n    inputRef: inputRefProp,\n    ...restProps\n  } = props;\n\n  const { announce } = useAriaAnnouncer({ debounce: 1000 });\n\n  const expandButtonRef = useRef(null);\n  const listRef = useRef(null);\n  // Use callback ref as listRef could be null when it's closed\n  const setListRef = useForkRef(listRef, listRefProp);\n\n  const { inputRef, listContext, inputProps, listProps, inputHelpers } =\n    useMultiSelectComboBox({\n      ...restProps,\n      expandButtonRef,\n    });\n\n  const { allowAnnouncement, disabled, value, ...restInputProps } = inputProps;\n  const { isListOpen, itemCount, itemToString, source, ...restListProps } =\n    listProps;\n\n  const firstItem = null;\n\n  const allowAnnouncementRef = useRef(allowAnnouncement);\n  useEffect(() => {\n    allowAnnouncementRef.current = allowAnnouncement;\n  }, [allowAnnouncement]);\n\n  useEffect(() => {\n    if (allowAnnouncementRef.current && value && firstItem) {\n      announce(getAnnouncement(itemCount, firstItem));\n    }\n  }, [value, firstItem, itemCount, announce]);\n\n  const [maxListHeight, setMaxListHeight] = useState<number | undefined>(\n    undefined\n  );\n  const middleware = isDesktop\n    ? []\n    : [\n        flip({\n          fallbackPlacements: [\"bottom-start\", \"top-start\"],\n        }),\n        shift({ limiter: limitShift() }),\n        size({\n          apply({ availableHeight }) {\n            setMaxListHeight(availableHeight);\n          },\n        }),\n      ];\n  const { reference, floating, x, y, strategy } = useFloatingUI({\n    placement: \"bottom-start\",\n    middleware,\n  });\n\n  useEffect(() => {\n    if (rootRef.current) {\n      reference(rootRef.current);\n    }\n  }, [rootRef, reference]);\n\n  const Window = useWindow();\n\n  return (\n    <>\n      <TokenizedInputBase\n        disabled={disabled}\n        expandButtonRef={expandButtonRef}\n        inputRef={useForkRef(inputRef, inputRefProp)}\n        value={value}\n        helpers={inputHelpers}\n        {...restInputProps}\n      />\n      {rootRef.current && isListOpen && (\n        <Portal>\n          <Window\n            style={{\n              top: y ?? 0,\n              left: x ?? 0,\n              position: strategy,\n              maxHeight: maxListHeight ?? \"\",\n            }}\n            {...WindowProps}\n            ref={floating}\n          >\n            <ListStateContext.Provider value={listContext}>\n              <ListBase\n                {...{\n                  ListItem,\n                  disabled,\n                  itemCount,\n                  itemToString,\n                  width: listWidth || rootWidth,\n                  source,\n                  ...restListProps,\n                  listRef: setListRef,\n                }}\n                maxHeight={maxListHeight || listProps.maxHeight}\n              />\n            </ListStateContext.Provider>\n          </Window>\n        </Portal>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}