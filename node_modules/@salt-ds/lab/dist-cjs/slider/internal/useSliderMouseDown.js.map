{"version":3,"file":"useSliderMouseDown.js","sources":["../src/slider/internal/useSliderMouseDown.ts"],"sourcesContent":["import {\n  MouseEvent as ReactMouseEvent,\n  RefObject,\n  useCallback,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { SliderChangeHandler, SliderValue } from \"../types\";\nimport { clampValue, roundValue, UpdateValueItem } from \"./utils\";\n\ninterface MouseContext {\n  min: number;\n  max: number;\n  step: number;\n  value: SliderValue;\n  trackRef: RefObject<HTMLDivElement>;\n  handleIndex?: number;\n  updateValueItem: UpdateValueItem;\n  setValue: SliderChangeHandler;\n  onChange?: SliderChangeHandler;\n}\n\nconst valueFromClientX = (context: MouseContext, x: number) => {\n  const { min, max, step, trackRef } = context;\n  const rect = trackRef.current!.getBoundingClientRect();\n  const localX = x - rect.x;\n  let v = (localX / rect.width) * (max - min) + min;\n  v = roundValue(v, step);\n  v = clampValue(v, min, max);\n  return v;\n};\n\nfunction getNearestHandle(value: SliderValue, clickValue: number): number {\n  if (!Array.isArray(value)) {\n    return 0;\n  }\n  let minDistance = Number.MAX_VALUE;\n  let handleIndex = -1;\n  value.forEach((v, i) => {\n    const d = Math.abs(clickValue - v);\n    if (d < minDistance) {\n      minDistance = d;\n      handleIndex = i;\n    }\n  });\n  return handleIndex;\n}\n\nexport function useSliderMouseDown(\n  trackRef: RefObject<HTMLDivElement>,\n  value: SliderValue,\n  min: number,\n  max: number,\n  step: number,\n  updateValueItem: UpdateValueItem,\n  setValue: SliderChangeHandler,\n  onChange?: SliderChangeHandler\n) {\n  const mouseContext = useRef<MouseContext>({\n    min,\n    max,\n    step,\n    value,\n    trackRef,\n    updateValueItem,\n    setValue,\n    onChange,\n  });\n\n  useEffect(() => {\n    const c = mouseContext.current;\n    c.min = min;\n    c.max = max;\n    c.step = step;\n    c.value = value;\n    c.updateValueItem = updateValueItem;\n    c.onChange = onChange;\n    c.setValue = setValue;\n  }, [min, max, step, value, setValue, updateValueItem, onChange]);\n\n  const onMouseMove = useCallback((event: MouseEvent) => {\n    const { handleIndex, value, updateValueItem, setValue, onChange } =\n      mouseContext.current;\n    if (handleIndex === undefined) {\n      return;\n    }\n    const { clientX } = event;\n    const clickValue = valueFromClientX(mouseContext.current, clientX);\n    const newValue = updateValueItem(value, handleIndex, clickValue);\n    if (newValue !== value) {\n      setValue(newValue);\n      if (onChange) {\n        onChange(newValue);\n      }\n    }\n  }, []);\n\n  const onMouseUp = useCallback((event: MouseEvent) => {\n    document.removeEventListener(\"mouseup\", onMouseUp);\n    document.removeEventListener(\"mousemove\", onMouseMove);\n    mouseContext.current.handleIndex = undefined;\n  }, []);\n\n  return useCallback((event: ReactMouseEvent) => {\n    const { value, setValue, onChange } = mouseContext.current;\n    document.addEventListener(\"mouseup\", onMouseUp);\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    const { clientX } = event;\n    const clickValue = valueFromClientX(mouseContext.current, clientX);\n\n    const handleIndex = getNearestHandle(value, clickValue);\n    mouseContext.current.handleIndex = handleIndex;\n    const newValue = updateValueItem(value, handleIndex, clickValue);\n\n    if (newValue !== value) {\n      setValue(newValue);\n      if (onChange) {\n        onChange(newValue);\n      }\n    }\n\n    event.preventDefault();\n  }, []);\n}\n"],"names":["roundValue","clampValue","useRef","useEffect","useCallback","value","updateValueItem","setValue","onChange"],"mappings":"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"}