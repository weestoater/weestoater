{"version":3,"file":"useList.js","sources":["../src/list-deprecated/useList.ts"],"sourcesContent":["import {\n  ownerDocument,\n  useControlled,\n  useForkRef,\n  useId,\n  useIsFocusVisible,\n} from \"@salt-ds/core\";\n\nimport {\n  AriaAttributes,\n  Dispatch,\n  FocusEvent,\n  KeyboardEvent,\n  KeyboardEventHandler,\n  MouseEvent,\n  Ref,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  ListMultiSelectionVariant,\n  ListProps,\n  ListSelectionVariant,\n} from \"./ListProps\";\n\ntype keyHandler = (event: KeyboardEvent<HTMLInputElement>) => void;\n\ninterface listBoxAriaProps\n  extends Pick<\n    AriaAttributes,\n    \"aria-activedescendant\" | \"aria-multiselectable\"\n  > {\n  role: string; // We will default it to be 'listbox', but users can override\n}\nexport interface ListState<\n  Item = string,\n  Variant extends ListSelectionVariant = \"default\"\n> {\n  id?: string;\n  focusVisible: boolean;\n  selectedItem?: Variant extends ListMultiSelectionVariant ? Array<Item> : Item;\n  highlightedIndex?: number;\n  isDeselectable: boolean;\n  isMultiSelect: boolean;\n  isDisabled: boolean;\n}\n\nexport interface ListHelpers<\n  Item = string,\n  Variant extends ListSelectionVariant = \"default\"\n> {\n  setFocusVisible: (visible: boolean) => void;\n  setSelectedItem: Dispatch<\n    SetStateAction<\n      (Variant extends ListMultiSelectionVariant ? Item[] : Item) | undefined\n    >\n  >;\n  setHighlightedIndex: (highlightedIndex?: number) => void;\n  handleSelect: (\n    event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n    index: number | undefined,\n    item: Item\n  ) => void;\n  keyDownHandlers: { [key: string]: KeyboardEventHandler };\n  // TODO: Form Field\n}\n\nexport function useList<Item, Variant extends ListSelectionVariant>(\n  props: ListProps<Item, Variant> = {}\n): {\n  focusedRef: Ref<any>;\n  listProps: Partial<ListProps<Item, Variant>> & listBoxAriaProps;\n  state: ListState<Item, Variant>;\n  helpers: ListHelpers<Item, Variant>;\n} {\n  validateProps(props);\n\n  const generatedId = useId(props.id);\n\n  const {\n    id = generatedId,\n    source = [],\n    itemCount = source.length,\n    getItemId = (index) => `${id}-item-${index}`,\n    getItemAtIndex: getItemAtIndexProp,\n    getItemIndex: getItemIndexProp,\n    displayedItemCount = 10,\n    initialSelectedItem,\n    selectionVariant,\n    disabled = false,\n    onBlur,\n    onChange,\n    onFocus,\n    onKeyDown,\n    onMouseDown,\n    onMouseLeave,\n    onSelect,\n    disableMouseDown,\n    restoreLastFocus,\n    highlightedIndex: highlightedIndexProp,\n    selectedItem: selectedItemProp,\n    tabToSelect,\n    ...restProps\n  } = props;\n\n  const {\n    isFocusVisibleRef,\n    onFocus: handleFocusVisible,\n    onBlur: handleBlurVisible,\n    ref: focusVisibleRef,\n  } = useIsFocusVisible();\n\n  const { current: isDeselectable } = useRef(\n    selectionVariant === \"deselectable\"\n  );\n  const { current: isMultiSelect } = useRef(\n    selectionVariant === \"multiple\" ||\n      selectionVariant === \"extended\" ||\n      Array.isArray(initialSelectedItem) ||\n      Array.isArray(selectedItemProp)\n  );\n\n  const { current: isExtendedSelect } = useRef(selectionVariant === \"extended\");\n\n  let getItemIndex = useCallback(\n    (item: Item) => source.indexOf(item),\n    [source]\n  );\n  let getItemAtIndex = useCallback((index: number) => source[index], [source]);\n\n  const indexComparator = useCallback(\n    (a: Item, b: Item) => getItemIndex(a) - getItemIndex(b),\n    [getItemIndex]\n  );\n\n  // Only use getItemIndex and getItemAtIndex if both are defined; otherwise keep the defaults\n  if (\n    typeof getItemIndexProp === \"function\" &&\n    typeof getItemAtIndexProp === \"function\"\n  ) {\n    getItemIndex = getItemIndexProp;\n    getItemAtIndex = getItemAtIndexProp;\n  }\n\n  const rootRef = useRef();\n  const [focusVisible, setFocusVisible] = useState(false);\n  const [lastFocusedIndex, setLastFocusedIndex] = useState(-1);\n\n  const [selectedItem, setSelectedItem] = useControlled<\n    undefined | (Variant extends ListMultiSelectionVariant ? Item[] : Item)\n  >({\n    controlled: selectedItemProp,\n    default:\n      initialSelectedItem ??\n      ((isMultiSelect\n        ? []\n        : null) as unknown as Variant extends ListMultiSelectionVariant\n        ? Item[]\n        : Item),\n    name: \"useList\",\n    state: \"selectedItem\",\n  });\n\n  const [highlightedIndex, setHighlightedIndex] = useControlled<\n    number | undefined\n  >({\n    controlled: highlightedIndexProp,\n    default: undefined,\n    name: \"useList\",\n    state: \"highlightedIndex\",\n  });\n\n  const handleSingleSelect = useCallback(\n    (\n      event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n      index: number | undefined,\n      item: Item\n    ) => {\n      const isSelected = item === selectedItem;\n      let nextItem;\n\n      if (isSelected && !isDeselectable) {\n        return;\n      }\n\n      if (!isSelected) {\n        nextItem = item;\n        setHighlightedIndex(index);\n      } else {\n        nextItem = null;\n      }\n\n      setSelectedItem(\n        nextItem as Variant extends ListMultiSelectionVariant ? Item[] : Item\n      );\n\n      if (onChange) {\n        onChange(\n          event,\n          nextItem as Variant extends ListMultiSelectionVariant ? Item[] : Item\n        );\n      }\n    },\n    [\n      isDeselectable,\n      onChange,\n      selectedItem,\n      setHighlightedIndex,\n      setSelectedItem,\n    ]\n  );\n\n  const handleMultiSelect = useCallback(\n    (\n      event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n      index: number | undefined,\n      item: Item\n    ) => {\n      const isSelected = (selectedItem as Item[]).indexOf(item as Item) !== -1;\n      let nextItems = selectedItem as Item[];\n\n      if (!isSelected) {\n        nextItems = nextItems.concat([item]).sort(indexComparator);\n        setHighlightedIndex(index);\n      } else {\n        nextItems = nextItems.filter((selected: any) => selected !== item);\n      }\n\n      setSelectedItem(\n        nextItems as Variant extends ListMultiSelectionVariant ? Item[] : Item\n      );\n\n      if (onChange) {\n        onChange(\n          event,\n          nextItems as Variant extends ListMultiSelectionVariant ? Item[] : Item\n        );\n      }\n    },\n    [\n      indexComparator,\n      onChange,\n      selectedItem,\n      setHighlightedIndex,\n      setSelectedItem,\n    ]\n  );\n\n  const handleRangeSelect = useCallback(\n    (\n      event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n      index?: number\n    ) => {\n      const currentSelection =\n        event.ctrlKey || event.metaKey ? selectedItem : ([] as Item[]);\n\n      const lastSelectedItemIndex =\n        (selectedItem as Item[]).length > 0\n          ? getItemIndex(\n              (selectedItem as Item[])[(selectedItem as Item[]).length - 1]\n            )\n          : 0;\n\n      const startRegion = Math.min(\n        index ?? lastSelectedItemIndex,\n        lastSelectedItemIndex\n      );\n      const endRegion = Math.max(\n        index ?? lastSelectedItemIndex,\n        lastSelectedItemIndex\n      );\n      const rangeSelection = source.slice(startRegion, endRegion + 1);\n      // concat the current selection with a new selection and remove duplicates for overlaps\n      const nextItems = [\n        ...new Set([...(currentSelection as Item[]), ...rangeSelection]),\n      ];\n      // remove text selection caused by shift clicking\n      ownerDocument(event.currentTarget).getSelection()?.removeAllRanges();\n      setSelectedItem(\n        nextItems as Variant extends ListMultiSelectionVariant ? Item[] : Item\n      );\n\n      if (onChange) {\n        onChange(\n          event,\n          nextItems as Variant extends ListMultiSelectionVariant ? Item[] : Item\n        );\n      }\n    },\n    [getItemIndex, onChange, selectedItem, setSelectedItem, source]\n  );\n\n  const handleExtendedSelect = useCallback(\n    (\n      event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n      index: number | undefined,\n      item: Item\n    ) => {\n      let nextItems = selectedItem as Item[];\n      if (event.shiftKey) {\n        handleRangeSelect(event, index);\n      } else if (\n        (selectedItem as Item[]).length === 0 ||\n        event.ctrlKey ||\n        event.metaKey\n      ) {\n        console.log(\"handleMulti\");\n        handleMultiSelect(event, index, item);\n      } else {\n        nextItems = [item] as Item[];\n        setSelectedItem(\n          nextItems as Variant extends ListMultiSelectionVariant ? Item[] : Item\n        );\n\n        if (onChange) {\n          onChange(\n            event,\n            nextItems as Variant extends ListMultiSelectionVariant\n              ? Item[]\n              : Item\n          );\n        }\n      }\n    },\n    [\n      handleMultiSelect,\n      handleRangeSelect,\n      onChange,\n      selectedItem,\n      setSelectedItem,\n    ]\n  );\n\n  const handleSelect = useCallback(\n    (\n      event: MouseEvent<HTMLElement> | KeyboardEvent<HTMLElement>,\n      index: number | undefined,\n      item: Item | null\n    ) => {\n      if (item == null || (item as any).disabled) {\n        return;\n      }\n\n      if (onSelect) {\n        console.log(\"onSelect\");\n        onSelect(event, item);\n      }\n\n      if (isExtendedSelect) {\n        handleExtendedSelect(event, index, item);\n      } else if (isMultiSelect) {\n        handleMultiSelect(event, index, item);\n      } else {\n        handleSingleSelect(event, index, item);\n      }\n    },\n    [\n      handleExtendedSelect,\n      handleMultiSelect,\n      handleSingleSelect,\n      isExtendedSelect,\n      isMultiSelect,\n      onSelect,\n    ]\n  );\n\n  const saveFocusedIndex = (index: number) => {\n    setLastFocusedIndex(index);\n    return index;\n  };\n\n  const keyDownHandlers: { [key: string]: keyHandler } = {\n    ArrowUp: (event) => {\n      event.preventDefault();\n      setHighlightedIndex((prevHighlightedIndex?: number) =>\n        saveFocusedIndex(Math.max(0, (prevHighlightedIndex ?? itemCount) - 1))\n      );\n    },\n    ArrowDown: (event) => {\n      event.preventDefault();\n      setHighlightedIndex((prevHighlightedIndex?: number) =>\n        saveFocusedIndex(\n          Math.min(itemCount - 1, (prevHighlightedIndex ?? -1) + 1)\n        )\n      );\n    },\n    PageUp: (event) => {\n      event.preventDefault();\n      setHighlightedIndex((prevHighlightedIndex?: number) =>\n        saveFocusedIndex(\n          Math.max(\n            0,\n            (prevHighlightedIndex ?? displayedItemCount) - displayedItemCount\n          )\n        )\n      );\n    },\n    PageDown: (event) => {\n      event.preventDefault();\n      setHighlightedIndex((prevHighlightedIndex?: number) =>\n        saveFocusedIndex(\n          Math.min(\n            itemCount - 1,\n            (prevHighlightedIndex ?? 0) + displayedItemCount\n          )\n        )\n      );\n    },\n    Home: (event) => {\n      event.preventDefault();\n      setHighlightedIndex(saveFocusedIndex(0));\n    },\n    End: (event) => {\n      event.preventDefault();\n      setHighlightedIndex(saveFocusedIndex(itemCount - 1));\n    },\n    Enter: (event) => {\n      event.preventDefault();\n      handleSelect(\n        event,\n        highlightedIndex,\n        highlightedIndex != null && highlightedIndex > -1\n          ? getItemAtIndex(highlightedIndex)\n          : null\n      );\n    },\n    \" \": (event) => {\n      event.preventDefault();\n      handleSelect(\n        event,\n        highlightedIndex,\n        highlightedIndex != null && highlightedIndex > -1\n          ? getItemAtIndex(highlightedIndex)\n          : null\n      );\n    },\n    Tab: (event) => {\n      if (tabToSelect) {\n        handleSelect(\n          event,\n          highlightedIndex,\n          highlightedIndex != null && highlightedIndex > -1\n            ? getItemAtIndex(highlightedIndex)\n            : null\n        );\n      } else {\n        setHighlightedIndex(undefined);\n      }\n    },\n  };\n\n  const handleKeyDown: keyHandler = (event) => {\n    if (isFocusVisibleRef.current) {\n      setFocusVisible(true);\n    }\n\n    const handler: keyHandler = keyDownHandlers[event.key];\n\n    if (handler) {\n      handler(event);\n    }\n\n    if (onKeyDown) {\n      onKeyDown(event);\n    }\n  };\n\n  const handleFocus = (event: FocusEvent<HTMLDivElement>) => {\n    handleFocusVisible(event);\n    if (isFocusVisibleRef.current) {\n      setFocusVisible(true);\n    }\n\n    // Work out the index to highlight\n    if (highlightedIndex === undefined) {\n      const firstSelectedItem = isMultiSelect\n        ? (selectedItem as Item[])[0]\n        : (selectedItem as Item | undefined);\n\n      setHighlightedIndex(\n        Math.max(\n          restoreLastFocus\n            ? lastFocusedIndex\n            : firstSelectedItem\n            ? getItemIndex(firstSelectedItem)\n            : -1,\n          0\n        )\n      );\n    }\n\n    if (onFocus) {\n      onFocus(event);\n    }\n  };\n\n  const handleBlur = (event: FocusEvent<HTMLDivElement>) => {\n    setHighlightedIndex(undefined);\n    handleBlurVisible();\n    if (!isFocusVisibleRef.current) {\n      setFocusVisible(false);\n    }\n\n    if (onBlur) {\n      onBlur(event);\n    }\n  };\n\n  const handleMouseDown = (event: MouseEvent<HTMLDivElement>) => {\n    if (disableMouseDown) {\n      event.preventDefault();\n    } else if (onMouseDown) {\n      onMouseDown(event);\n    }\n  };\n\n  const handleMouseLeave = (event: MouseEvent<HTMLDivElement>) => {\n    if (focusVisible && id) {\n      // Get the root node of the component if we have access to it otherwise default to current document\n      const rootNode = (\n        rootRef.current || ownerDocument(event.currentTarget)\n      ).getRootNode();\n\n      const listNode = (rootNode as Document).getElementById(id);\n\n      // Safety check as `mouseleave` could have been accidentally triggered by an opening tooltip\n      // when you use keyboard to navigate, hence the focusVisible check earlier\n      if (listNode?.contains(event.target as Node)) {\n        setHighlightedIndex(undefined);\n      }\n    } else {\n      setHighlightedIndex(undefined);\n    }\n\n    if (onMouseLeave) {\n      onMouseLeave(event);\n    }\n  };\n\n  const eventHandlers = {\n    onFocus: handleFocus,\n    onBlur: handleBlur,\n    onKeyDown: handleKeyDown,\n    onMouseDown: handleMouseDown,\n    onMouseLeave: handleMouseLeave,\n  };\n\n  const ariaProps: listBoxAriaProps = {\n    role: \"listbox\",\n    \"aria-activedescendant\":\n      highlightedIndex !== undefined && highlightedIndex >= 0\n        ? getItemId(highlightedIndex)\n        : undefined,\n  };\n\n  if (isMultiSelect) {\n    ariaProps[\"aria-multiselectable\"] = true;\n  }\n\n  return {\n    focusedRef: useForkRef(rootRef, focusVisibleRef),\n    state: {\n      id,\n      focusVisible,\n      selectedItem,\n      highlightedIndex,\n      isDeselectable,\n      isMultiSelect,\n      isDisabled: disabled,\n    },\n    helpers: {\n      setFocusVisible,\n      setSelectedItem,\n      setHighlightedIndex,\n      keyDownHandlers,\n      handleSelect,\n    },\n    listProps: {\n      id,\n      source,\n      itemCount,\n      disableMouseDown,\n      displayedItemCount,\n      getItemAtIndex,\n      getItemIndex,\n      getItemId,\n      disabled,\n      ...ariaProps,\n      ...restProps,\n      ...(disabled ? {} : eventHandlers),\n    },\n  };\n}\n\nconst validateProps = <Item, Variant extends ListSelectionVariant>(\n  props: ListProps<Item, Variant>\n) => {\n  if (process.env.NODE_ENV !== \"production\") {\n    const { source, itemCount, getItemIndex, getItemAtIndex } = props;\n\n    const hasIndexer =\n      typeof getItemIndex === \"function\" &&\n      typeof getItemAtIndex === \"function\";\n\n    const hasNoIndexer =\n      getItemIndex === undefined && getItemAtIndex === undefined;\n\n    const sourceNotArray = !Array.isArray(source);\n\n    useEffect(() => {\n      if (sourceNotArray) {\n        console.error(\"`source` for useList must be an array.\");\n      }\n    }, [sourceNotArray]);\n\n    useEffect(() => {\n      if (!hasNoIndexer && !hasIndexer) {\n        console.error(\n          \"useList needs to have both `getItemIndex` and `getItemAtIndex`.\"\n        );\n      }\n\n      if (!hasNoIndexer && itemCount === undefined) {\n        console.error(\n          \"useList needs to have `itemCount` if an indexer is used.\"\n        );\n      }\n    }, [hasIndexer, hasNoIndexer, itemCount]);\n  }\n};\n"],"names":["useId","useIsFocusVisible","useRef","useCallback","useState","useControlled","ownerDocument","useForkRef","useEffect"],"mappings":"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"}