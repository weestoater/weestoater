'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var keyUtils = require('./keyUtils.js');

const useTypeahead = ({
  disableTypeToSelect,
  highlightedIdx,
  highlightItemAtIndex,
  typeToNavigate,
  items,
  applyIncrementalSearch = true
}) => {
  const keyDownTimer = React.useRef(null);
  const searchChars = React.useRef("");
  const startIdx = React.useRef(-1);
  const applySearch = React.useCallback(
    (intermediateSearch) => {
      if (intermediateSearch || !applyIncrementalSearch) {
        const regex = new RegExp(`^${searchChars.current}`, "i");
        let idx = items.findIndex(
          ({ label }, i) => i > startIdx.current && regex.test(label)
        );
        if (idx === -1) {
          idx = items.findIndex(
            ({ label }, i) => i <= startIdx.current && regex.test(label)
          );
        }
        if (idx !== -1) {
          highlightItemAtIndex(idx);
        }
      } else {
        searchChars.current = "";
        keyDownTimer.current = null;
        startIdx.current = -1;
      }
    },
    [applyIncrementalSearch, highlightItemAtIndex, items]
  );
  const handleKeyDown = React.useCallback(
    (e) => {
      const searchInProgress = startIdx.current !== -1;
      if (keyUtils.isCharacterKey(e) || searchInProgress && e.key === keyUtils.Space) {
        if (typeToNavigate) {
          e.preventDefault();
          e.stopPropagation();
          if (startIdx.current === -1 || e.key === searchChars.current) {
            startIdx.current = highlightedIdx;
          }
          if (keyDownTimer.current !== null) {
            clearTimeout(keyDownTimer.current);
            keyDownTimer.current = null;
          }
          if (e.key !== searchChars.current) {
            searchChars.current += e.key;
          }
          if (applyIncrementalSearch) {
            applySearch(true);
          }
          keyDownTimer.current = window.setTimeout(() => {
            applySearch();
          }, 100);
        }
      }
    },
    [typeToNavigate, applyIncrementalSearch, highlightedIdx, applySearch]
  );
  return {
    onKeyDown: disableTypeToSelect ? void 0 : handleKeyDown
  };
};

exports.useTypeahead = useTypeahead;
//# sourceMappingURL=useTypeahead.js.map
