{"version":3,"file":"useControlled.js","sources":["../src/utils/useControlled.ts"],"sourcesContent":["import {\n  Dispatch,\n  isValidElement,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nexport interface UseControlledProps<T> {\n  /**\n   * Holds the component value when it's controlled.\n   */\n  controlled?: T;\n  /**\n   * The default value when uncontrolled.\n   */\n  default: T;\n  /**\n   * The component name displayed in warnings.\n   */\n  name: string;\n  /**\n   * The name of the state variable displayed in warnings.\n   */\n  state?: string;\n}\n\n/**\n * Copied from MUI (v5) useControlled hook with one additional returned value\n * @see https://github.com/mui-org/material-ui/blob/0979e6a54ba47c278d1f535953c0520a86349811/packages/material-ui-utils/src/useControlled.js\n */\nexport function useControlled<S>({\n  controlled,\n  default: defaultProp,\n  name,\n  state = \"value\",\n}: UseControlledProps<S>): [S, Dispatch<SetStateAction<S>>, boolean] {\n  const { current: isControlled } = useRef(controlled !== undefined);\n  const [valueState, setValue] = useState<S>(defaultProp);\n  const value = controlled !== undefined ? controlled : valueState;\n  const { current: defaultValue } = useRef(defaultProp);\n\n  useEffect(() => {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (isControlled !== (controlled !== undefined)) {\n        console.error(\n          [\n            `Salt: A component is changing the ${\n              isControlled ? \"\" : \"un\"\n            }controlled ${state} state of ${name} to be ${\n              isControlled ? \"un\" : \"\"\n            }controlled.`,\n            \"Elements should not switch from uncontrolled to controlled (or vice versa).\",\n            `Decide between using a controlled or uncontrolled ${name} ` +\n              \"element for the lifetime of the component.\",\n            \"The nature of the state is determined during the first render, it's considered controlled if the value is not `undefined`.\",\n            \"More info: https://fb.me/react-controlled-components\",\n          ].join(\"\\n\")\n        );\n      }\n    }\n    return undefined;\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, [state, name, controlled]);\n\n  useEffect(() => {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (!isControlled && defaultValue !== defaultProp) {\n        console.error(\n          [\n            `Salt: A component is changing the default ${state} state of an uncontrolled ${name} after being initialized. ` +\n              `To suppress this warning opt to use a controlled ${name}.`,\n          ].join(\"\\n\")\n        );\n      }\n    }\n    return undefined;\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, [JSON.stringify(defaultProp, ignoreReactElements)]);\n\n  const setValueIfUncontrolled: Dispatch<SetStateAction<S>> = useCallback(\n    (newValue) => {\n      if (!isControlled) {\n        setValue(newValue);\n      }\n    },\n    [isControlled]\n  );\n\n  return [value, setValueIfUncontrolled, isControlled];\n}\n\n// Ignore ReactElements in JSON, they contain circular refs\nfunction ignoreReactElements<T>(key: string, value: T): T | null {\n  return isValidElement(value) ? null : value;\n}\n"],"names":["useRef","useState","useEffect","useCallback","isValidElement"],"mappings":";;;;;;AAiCO,SAAS,aAAiB,CAAA;AAAA,EAC/B,UAAA;AAAA,EACA,OAAS,EAAA,WAAA;AAAA,EACT,IAAA;AAAA,EACA,KAAQ,GAAA,OAAA;AACV,CAAqE,EAAA;AACnE,EAAA,MAAM,EAAE,OAAS,EAAA,YAAA,EAAiB,GAAAA,YAAA,CAAO,eAAe,KAAS,CAAA,CAAA,CAAA;AACjE,EAAA,MAAM,CAAC,UAAA,EAAY,QAAQ,CAAA,GAAIC,eAAY,WAAW,CAAA,CAAA;AACtD,EAAM,MAAA,KAAA,GAAQ,UAAe,KAAA,KAAA,CAAA,GAAY,UAAa,GAAA,UAAA,CAAA;AACtD,EAAA,MAAM,EAAE,OAAA,EAAS,YAAa,EAAA,GAAID,aAAO,WAAW,CAAA,CAAA;AAEpD,EAAAE,eAAA,CAAU,MAAM;AACd,IAAI,IAAA,OAAA,CAAQ,GAAI,CAAA,QAAA,KAAa,YAAc,EAAA;AACzC,MAAI,IAAA,YAAA,MAAkB,eAAe,KAAY,CAAA,CAAA,EAAA;AAC/C,QAAQ,OAAA,CAAA,KAAA;AAAA,UACN;AAAA,YACE,qCACE,YAAe,GAAA,EAAA,GAAK,kBACR,KAAkB,CAAA,UAAA,EAAA,IAAA,CAAA,OAAA,EAC9B,eAAe,IAAO,GAAA,EAAA,CAAA,WAAA,CAAA;AAAA,YAExB,6EAAA;AAAA,YACA,CAAqD,kDAAA,EAAA,IAAA,CAAA,2CAAA,CAAA;AAAA,YAErD,4HAAA;AAAA,YACA,sDAAA;AAAA,WACF,CAAE,KAAK,IAAI,CAAA;AAAA,SACb,CAAA;AAAA,OACF;AAAA,KACF;AACA,IAAO,OAAA,KAAA,CAAA,CAAA;AAAA,GAEN,EAAA,CAAC,KAAO,EAAA,IAAA,EAAM,UAAU,CAAC,CAAA,CAAA;AAE5B,EAAAA,eAAA,CAAU,MAAM;AACd,IAAI,IAAA,OAAA,CAAQ,GAAI,CAAA,QAAA,KAAa,YAAc,EAAA;AACzC,MAAI,IAAA,CAAC,YAAgB,IAAA,YAAA,KAAiB,WAAa,EAAA;AACjD,QAAQ,OAAA,CAAA,KAAA;AAAA,UACN;AAAA,YACE,CAAA,0CAAA,EAA6C,kCAAkC,IACzB,CAAA,2EAAA,EAAA,IAAA,CAAA,CAAA,CAAA;AAAA,WACxD,CAAE,KAAK,IAAI,CAAA;AAAA,SACb,CAAA;AAAA,OACF;AAAA,KACF;AACA,IAAO,OAAA,KAAA,CAAA,CAAA;AAAA,KAEN,CAAC,IAAA,CAAK,UAAU,WAAa,EAAA,mBAAmB,CAAC,CAAC,CAAA,CAAA;AAErD,EAAA,MAAM,sBAAsD,GAAAC,iBAAA;AAAA,IAC1D,CAAC,QAAa,KAAA;AACZ,MAAA,IAAI,CAAC,YAAc,EAAA;AACjB,QAAA,QAAA,CAAS,QAAQ,CAAA,CAAA;AAAA,OACnB;AAAA,KACF;AAAA,IACA,CAAC,YAAY,CAAA;AAAA,GACf,CAAA;AAEA,EAAO,OAAA,CAAC,KAAO,EAAA,sBAAA,EAAwB,YAAY,CAAA,CAAA;AACrD,CAAA;AAGA,SAAS,mBAAA,CAAuB,KAAa,KAAoB,EAAA;AAC/D,EAAO,OAAAC,oBAAA,CAAe,KAAK,CAAA,GAAI,IAAO,GAAA,KAAA,CAAA;AACxC;;;;"}