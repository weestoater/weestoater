import * as React from 'react';
import { useInsertionPoint } from './InsertionPointProvider.js';
import { useStyleInjection } from '../style-injection-provider/index.js';

var _a;
const maybeUseInsertionEffect = (_a = React["useInsertionEffect".toString()]) != null ? _a : React.useLayoutEffect;
const windowSheetsMap = /* @__PURE__ */ new WeakMap();
function useComponentCssInjection({
  testId,
  css,
  window: targetWindow
}) {
  const styleInjectionEnabled = useStyleInjection();
  const insertionPoint = useInsertionPoint();
  maybeUseInsertionEffect(() => {
    var _a2, _b;
    if (!targetWindow || !styleInjectionEnabled) {
      return;
    }
    const sheetsMap = (_a2 = windowSheetsMap.get(targetWindow)) != null ? _a2 : /* @__PURE__ */ new Map();
    const styleMap = (_b = sheetsMap.get(css)) != null ? _b : { styleElement: null, count: 0 };
    if (styleMap.styleElement == null) {
      styleMap.styleElement = targetWindow.document.createElement("style");
      styleMap.styleElement.setAttribute("type", "text/css");
      styleMap.styleElement.setAttribute("data-salt-style", testId || "");
      styleMap.styleElement.textContent = css;
      styleMap.count = 1;
      targetWindow.document.head.insertBefore(
        styleMap.styleElement,
        insertionPoint || targetWindow.document.head.firstChild
      );
    } else {
      styleMap.styleElement.textContent = css;
      styleMap.count++;
    }
    sheetsMap.set(css, styleMap);
    windowSheetsMap.set(targetWindow, sheetsMap);
    return () => {
      const sheetsMap2 = windowSheetsMap.get(targetWindow);
      const styleMap2 = sheetsMap2 == null ? void 0 : sheetsMap2.get(css);
      if (styleMap2 == null ? void 0 : styleMap2.styleElement) {
        styleMap2.count--;
        if (styleMap2.count < 1) {
          targetWindow.document.head.removeChild(styleMap2.styleElement);
          styleMap2.styleElement = null;
          sheetsMap2 == null ? void 0 : sheetsMap2.delete(css);
        }
      }
    };
  }, [testId, css, targetWindow]);
}

export { useComponentCssInjection };
//# sourceMappingURL=useStyleInjection.js.map
